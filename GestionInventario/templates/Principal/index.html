{% extends 'base.html' %}

{% block title %}Inicio{% endblock %}

{% block content %}
<div class="container mt-4">
    <header class="text-center mb-5">
        <h1 class="display-4">Sistema de Gestión de Inventario</h1>
        <p class="lead">Bienvenido al sistema de control de inventario de juegos y consolas</p>
        
        <!-- Información del rol del usuario - CORREGIDO -->
        <div class="alert alert-info d-inline-block">
            <small><strong>Conectado como:</strong> {{ user.username }} | <strong>Rol:</strong> {{ user_rol }}</small>
        </div>
        
        <!-- DEBUG: Mostrar todas las variables disponibles -->
        {% if debug %}
        <div class="alert alert-warning mt-2">
            <strong>DEBUG Info:</strong><br>
            user_rol: {{ user_rol }}<br>
            is_dueño: {{ is_dueño }}<br>
            is_bodeguero: {{ is_bodeguero }}<br>
            is_locatario: {{ is_locatario }}<br>
            puede_modificar_inventario: {{ puede_modificar_inventario }}<br>
            puede_gestionar_stock: {{ puede_gestionar_stock }}
        </div>
        {% endif %}
    </header>

    <!-- Mostrar mensajes de error -->
    {% if messages %}
    <div class="row">
        <div class="col-12">
            {% for message in messages %}
            <div class="alert alert-{% if message.tags %}{{ message.tags }}{% else %}info{% endif %} alert-dismissible fade show" role="alert">
                <strong>{{ message }}</strong>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="row d-flex justify-content-center">
        <!-- Tarjeta de Juegos - VISIBLE PARA TODOS -->
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="card-title mb-0">Gestión de Juegos</h3>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <!-- Registrar juego - SOLO DUEÑO Y BODEGUERO -->
                        {% if puede_modificar_inventario %}
                        <li class="list-group-item">
                            <a href="{% url 'registrar_juego' %}" class="text-decoration-none">
                                <i class="fas fa-plus-circle me-2"></i> Registrar nuevo juego
                            </a>
                        </li>
                        {% endif %}
                        
                        <!-- Ver juegos - TODOS LOS ROLES -->
                        <li class="list-group-item">
                            <a href="{% url 'listar_juegos_con_stock' %}" class="text-decoration-none">
                                <i class="fas fa-list me-2"></i> Ver todos los juegos
                            </a>
                        </li>
                        
                        <!-- Juegos descontinuados - TODOS LOS ROLES -->
                        <li class="list-group-item">
                            <a href="{% url 'listar_juegos_descontinuados' %}" class="text-decoration-none">
                                <i class="fas fa-ban me-2"></i> Juegos descontinuados
                            </a>
                        </li>
                        
                        <!-- Devoluciones - SOLO DUEÑO Y BODEGUERO -->
                        {% if puede_gestionar_stock %}
                        <li class="list-group-item">
                            <a href="{% url 'listar_devoluciones' %}" class="text-decoration-none">
                                <i class="fas fa-undo me-2"></i> Ver devoluciones
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Tarjeta de Administración-->
        {% if is_dueño or is_bodeguero or is_admin_web %}
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow">
                <div class="card-header bg-success text-white">
                    <h3 class="card-title mb-0">Administración</h3>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">

                        <!-- Gestionar ubicaciones - dueño + bodeguero -->
                        {% if is_dueño or is_bodeguero %}
                        <li class="list-group-item">
                            <a href="{% url 'lista_ubicaciones' %}" class="text-decoration-none">
                                <i class="fas fa-map-marker-alt me-2"></i> Gestionar ubicaciones
                            </a>
                        </li>
                        {% endif %}

                        <!-- Gestionar usuarios - dueño + admin web -->
                        {% if is_dueño or is_admin_web %}
                        <li class="list-group-item">
                            <a href="{% url 'gestion_usuarios' %}" class="text-decoration-none">
                                <i class="fas fa-users me-2"></i> Gestionar usuarios
                            </a>
                        </li>
                        {% endif %}

                        <!-- Agregar consola - dueño + bodeguero -->
                        {% if is_dueño or is_bodeguero %}
                        <li class="list-group-item">
                            <a href="{% url 'registrar_consola' %}" class="text-decoration-none">
                                <i class="fas fa-gamepad me-2"></i> Agregar consola
                            </a>
                        </li>
                        {% endif %}

                    </ul>
                </div>
            </div>
        </div>
        {% endif %}

        
        <!-- Tarjeta de Reportes - SOLO DUEÑO -->
        {% if is_dueño %}
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow">
                <div class="card-header bg-warning text-white">
                    <h3 class="card-title mb-0">Reportes</h3>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <a href="{% url 'movimientos_stock' %}" class="text-decoration-none">
                                <i class="fas fa-exchange-alt me-2"></i> Movimientos de Stock
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="{% url 'cambios_juegos' %}" class="text-decoration-none">
                                <i class="fas fa-history me-2"></i> Historial de Cambios
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="{% url 'estadisticas_stock' %}" class="text-decoration-none">
                                <i class="fas fa-chart-bar me-2"></i> Estadísticas de Stock
                            </a>
                        </li>
                        
                        <!-- Admin Django - SOLO DUEÑO -->
                        <li class="list-group-item">
                            <a href="{% url 'admin:index' %}" class="text-decoration-none">
                                <i class="fas fa-cog me-2"></i> Administración Django
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Mensaje informativo para LOCATARIOS -->
    {% if is_locatario %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="alert alert-info">
                <h5><i class="fas fa-info-circle me-2"></i>Información para Locatarios</h5>
                <p class="mb-0">Tu rol de <strong>locatario</strong> te permite visualizar información del inventario pero no realizar modificaciones. 
                Puedes consultar el stock disponible y buscar juegos.</p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Mensaje informativo para BODEGUEROS -->
    {% if is_bodeguero %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="alert alert-warning">
                <h5><i class="fas fa-tools me-2"></i>Información para Bodegueros</h5>
                <p class="mb-0">Tu rol de <strong>bodeguero</strong> te permite gestionar el inventario, stock y ubicaciones, pero no tienes acceso a reportes ni administración de usuarios.</p>
            </div>
        </div>
    </div>
    {% endif %}

    {% if is_admin_web %}
        <div class="row mt-4">
            <div class="col-12">
                <div class="alert alert-secondary">
                    <h5><i class="fas fa-user-shield me-2"></i>Información para Administrador Web</h5>
                    <p class="mb-0">
                        Tu rol de <strong>Administrador Web</strong> te permite gestionar usuarios del sistema 
                        pero no realizar acciones de inventario o stock.
                    </p>
                </div>
            </div>
        </div>
    {% endif %}


    <footer class="mt-5 pt-3 text-center text-muted">
        <p>Sistema de Inventario &copy; {% now "Y" %}</p>
    </footer>
</div>
{% endblock %}